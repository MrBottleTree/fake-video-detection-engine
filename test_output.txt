test_audio_standardization (test_a1_audio_standardization.TestA1AudioStandardization.test_audio_standardization) ... ok
test_missing_data_dir (test_a1_audio_standardization.TestA1AudioStandardization.test_missing_data_dir) ... ok
test_missing_audio (test_a2_vad_asr.TestA2VadAsr.test_missing_audio) ... ok
test_vad_asr_success (test_a2_vad_asr.TestA2VadAsr.test_vad_asr_success) ... ok
test_missing_audio (test_a3_audio_onsets.TestA3AudioOnsets.test_missing_audio) ... ok
test_onset_detection (test_a3_audio_onsets.TestA3AudioOnsets.test_onset_detection) ... ok
test_anti_sync (test_c1_lip_sync_score.TestC1LipSyncScore.test_anti_sync)
Tests where the mouth is closed during audio onsets. ... ok
test_delayed_sync (test_c1_lip_sync_score.TestC1LipSyncScore.test_delayed_sync)
Tests a scenario where mouth movements are slightly delayed. ... ok
test_missing_data_returns_zero (test_c1_lip_sync_score.TestC1LipSyncScore.test_missing_data_returns_zero)
Tests that missing essential data lists results in a score of 0.0. ... ok
test_missing_metadata_returns_zero (test_c1_lip_sync_score.TestC1LipSyncScore.test_missing_metadata_returns_zero)
Tests that missing essential metadata results in a score of 0.0. ... ok
test_no_activity_returns_zero (test_c1_lip_sync_score.TestC1LipSyncScore.test_no_activity_returns_zero)
Tests that no variation in signals results in a score of 0.0. ... ok
test_no_sync (test_c1_lip_sync_score.TestC1LipSyncScore.test_no_sync)
Tests where mouth movements are unrelated to audio onsets. ... ok
test_perfect_sync (test_c1_lip_sync_score.TestC1LipSyncScore.test_perfect_sync)
Tests a scenario where mouth MAR peaks exactly at audio onsets. ... ok
test_basic_extraction (test_c3_extraction.TestC3Extraction.test_basic_extraction)
Test extraction of simple valid claims. ... 2025-11-24 01:34:27,464 - INFO - C3: GPU not available, using CPU.
2025-11-24 01:34:27,464 - INFO - C3: Loading Spacy model 'en_core_web_trf'...
ok
test_deduplication (test_c3_extraction.TestC3Extraction.test_deduplication)
Test that duplicate claims are removed. ... ok
test_fallback_logic (test_c3_extraction.TestC3Extraction.test_fallback_logic)
Test fallback to first sentence if no valid claims found. ... FAIL
test_filtering_heuristics (test_c3_extraction.TestC3Extraction.test_filtering_heuristics)
Test filtering of questions and short sentences. ... FAIL
test_ocr_integration (test_c3_extraction.TestC3Extraction.test_ocr_integration)
Test that claims are extracted from OCR results. ... FAIL
test_spacy_segmentation (test_c3_extraction.TestC3Extraction.test_spacy_segmentation)
Test that Spacy handles abbreviations correctly. ... ok
test_e1_run_structure (test_e1_robustness.TestE1Robustness.test_e1_run_structure)
Test that E1 run function returns state with evidence key and IDs. ... 2025-11-24 01:34:31,086 - INFO - Processing claim 1/2: Python is a programming language....
2025-11-24 01:34:31,287 - INFO - Processing claim 2/2: Simple string claim...
ok
test_smart_queries (test_e1_robustness.TestE1Robustness.test_smart_queries)
Test that smart queries (debunking/supporting) are generated. ... ok
test_web_searcher_fallback (test_e1_robustness.TestE1Robustness.test_web_searcher_fallback)
Test that WebSearcher falls back to different APIs. ... 2025-11-24 01:34:31,488 - ERROR - Serper failed: Serper failed
2025-11-24 01:34:31,488 - ERROR - Google CSE failed: Google failed
ok
test_about_page_boost (test_e2_reliability.TestE2Reliability.test_about_page_boost) ... ok
test_calculate_reliability_score (test_e2_reliability.TestE2Reliability.test_calculate_reliability_score) ... ok
test_consensus_boost (test_e2_reliability.TestE2Reliability.test_consensus_boost) ... ok
test_get_domain (test_e2_reliability.TestE2Reliability.test_get_domain) ... ok
test_aggregation_logic (test_e3_scorer.TestE3Scorer.test_aggregation_logic) ... ok
test_mixed_claims (test_e3_scorer.TestE3Scorer.test_mixed_claims) ... ok
test_no_evidence (test_e3_scorer.TestE3Scorer.test_no_evidence) ... ok
test_verdict_thresholds (test_e3_scorer.TestE3Scorer.test_verdict_thresholds) ... ok
test_invalid_local_file (test_in_node.TestInNode.test_invalid_local_file) ... ok
test_local_file_ingestion (test_in_node.TestInNode.test_local_file_ingestion) ... ok
test_url_ingestion (test_in_node.TestInNode.test_url_ingestion) ... ok
test_c1_windowed_robustness (test_robustness_fixes.TestRobustness.test_c1_windowed_robustness) ... ok
test_c3_extraction_spacy (test_robustness_fixes.TestRobustness.test_c3_extraction_spacy) ... ok
test_c3_ocr_fallback (test_robustness_fixes.TestRobustness.test_c3_ocr_fallback) ... ok
test_keyframe_extraction (test_v1_keyframes_facetrack.TestV1KeyframesFacetrack.test_keyframe_extraction) ... ok
test_missing_video (test_v1_keyframes_facetrack.TestV1KeyframesFacetrack.test_missing_video) ... ok
test_no_keyframes (test_v2_ocr_overlays.TestV2OCROverlays.test_no_keyframes) ... ok
test_ocr_extraction (test_v2_ocr_overlays.TestV2OCROverlays.test_ocr_extraction) ... 2025-11-24 01:34:32,672 - WARNING - Using CPU. Note: This module is much faster with a GPU.
ok
test_landmark_extraction (test_v3_mouth_landmarks.TestV3MouthLandmarks.test_landmark_extraction) ... ok
test_missing_video (test_v3_mouth_landmarks.TestV3MouthLandmarks.test_missing_video) ... ok
test_blink_and_pose_extraction (test_v4_blink_headpose.TestV4BlinkHeadPose.test_blink_and_pose_extraction) ... ok
test_missing_video (test_v4_blink_headpose.TestV4BlinkHeadPose.test_missing_video) ... ok

======================================================================
FAIL: test_fallback_logic (test_c3_extraction.TestC3Extraction.test_fallback_logic)
Test fallback to first sentence if no valid claims found.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\Users\vishr\OneDrive\Documents\Projects\AgenticAI lang graph\tests\test_c3_extraction.py", line 104, in test_fallback_logic
    self.assertEqual(len(claims), 1)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
AssertionError: 0 != 1

======================================================================
FAIL: test_filtering_heuristics (test_c3_extraction.TestC3Extraction.test_filtering_heuristics)
Test filtering of questions and short sentences.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\Users\vishr\OneDrive\Documents\Projects\AgenticAI lang graph\tests\test_c3_extraction.py", line 65, in test_filtering_heuristics
    self.assertNotIn("Is the earth flat?", texts)
    ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: 'Is the earth flat?' unexpectedly found in ['Is the earth flat?']

======================================================================
FAIL: test_ocr_integration (test_c3_extraction.TestC3Extraction.test_ocr_integration)
Test that claims are extracted from OCR results.
----------------------------------------------------------------------
Traceback (most recent call last):
  File "C:\Users\vishr\OneDrive\Documents\Projects\AgenticAI lang graph\tests\test_c3_extraction.py", line 86, in test_ocr_integration
    self.assertIn("Breaking News: The economy is recovering fast.", texts)
    ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError: 'Breaking News: The economy is recovering fast.' not found in []

----------------------------------------------------------------------
Ran 44 tests in 8.399s

FAILED (failures=3)

Testing audio standardization...
Node A1: Standardizing audio...
Audio standardized to: test_audio_processing\audio_16k.wav
Audio standardization test passed.

Testing missing data directory...
Node A1: Standardizing audio...
Error: Data directory not found at non_existent_dir
Missing data directory test passed.

Testing missing audio file...
Node A2: Running VAD and ASR...
Error: Audio file not found at non_existent_dir\audio_16k.wav
Missing audio test passed.

Testing VAD and ASR success...
Node A2: Running VAD and ASR...
Using device: cpu
Transcribing test_audio_a2\audio_16k.wav...
Transcription complete. Length: 27 chars.
VAD and ASR success test passed.

Testing missing audio file...
Node A3: Detecting audio onsets...
Error: Audio file not found at non_existent_dir\audio_16k.wav
Missing audio test passed.

Testing onset detection...
Node A3: Detecting audio onsets...
Detected 3 onsets.
Onset detection test passed.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Lip Sync Analysis Complete. Score: 0.1651 (Computed over 1 windows)
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Lip Sync Analysis Complete. Score: 0.9205 (Computed over 1 windows)
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Warning - Missing mouth landmarks or audio onsets. Cannot compute lip-sync score.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Warning - Missing mouth landmarks or audio onsets. Cannot compute lip-sync score.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Warning - Missing video FPS or duration from metadata. Cannot compute lip-sync score.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Warning - Missing video FPS or duration from metadata. Cannot compute lip-sync score.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Warning - Missing mouth landmarks or audio onsets. Cannot compute lip-sync score.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Warning - No valid windows found (silence or static). Defaulting to 0.0
 C1: Lip Sync Analysis Complete. Score: 0.0000 (Computed over 0 windows)
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Lip Sync Analysis Complete. Score: 0.2248 (Computed over 1 windows)
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Lip Sync Analysis Complete. Score: 0.9235 (Computed over 1 windows)
--- C3: Claim Extraction (Robust Transformer) ---
Fallback: Using first sentence: The sky is blue.
Extracted 1 claims.
 - The sky is blue.... (Conf: 0.5)
--- C3: Claim Extraction (Robust Transformer) ---
Fallback: Using first sentence: The earth is round.
Extracted 1 claims.
 - The earth is round.... (Conf: 0.5)
--- C3: Claim Extraction (Robust Transformer) ---
Extracted 0 claims.
--- C3: Claim Extraction (Robust Transformer) ---
Fallback: Using first sentence: Is the earth flat?
Extracted 1 claims.
 - Is the earth flat?... (Conf: 0.5)
--- C3: Claim Extraction (Robust Transformer) ---
Extracted 0 claims.
--- C3: Claim Extraction (Robust Transformer) ---
Extracted 1 claims.
 - Dr. Smith lives in the U.S.A. and he is a doctor.... (Conf: 0.9)
Node E1: Retrieving Web Evidence...
Processing 2 claims...
Node E1: Evidence retrieval complete. Found evidence for 2 claims.
--- E2: Source Reliability ---
Scored https://a.com: 0.70
Scored https://b.com: 0.70
Scored https://c.com: 0.70
--- E3: Claim Evidence Scorer ---
Claim: 'Claim 1...' -> Verdict: Highly Likely (Score: 0.80, Sources: 2)
--- E3: Claim Evidence Scorer ---
Claim: 'Claim 1...' -> Verdict: Highly Likely (Score: 0.80, Sources: 1)
Claim: 'Claim 2...' -> Verdict: Unverified (Score: 0.10, Sources: 1)
--- E3: Claim Evidence Scorer ---
Claim: 'Claim 1...' -> Verdict: Unverified (Score: 0.00, Sources: 0)

Testing invalid local file...
Processing local file: non_existent_video.mp4
Invalid local file test passed.

Testing local file ingestion...
Processing local file: C:\Users\vishr\OneDrive\Documents\Projects\AgenticAI lang graph\test_video.mp4
Extracting audio from: processed\video_20251124_013431\video.mp4
Warning: No audio track found in video.
Processing complete. Video: processed\video_20251124_013431\video.mp4, Audio: None
Local file ingestion test passed.

Testing URL ingestion (Mocked)...
Downloading video from URL: https://www.youtube.com/watch?v=test
No cookies.txt found. Using browser simulation (extractor_args).
Extracting audio from: processed/mock_video/video.mp4
Processing complete. Video: processed/mock_video/video.mp4, Audio: processed\video_20251124_013432\audio.wav
URL ingestion test passed.
Node C1: Analyzing Lip Sync (Robust Windowed Correlation)...
 C1: Lip Sync Analysis Complete. Score: 1.0829 (Computed over 2 windows)
Test Score: 1.0829344394332043
--- C3: Claim Extraction (Robust Transformer) ---
Extracted 1 claims.
 - Dr. Smith said the earth is round.... (Conf: 0.9)
--- C3: Claim Extraction (Robust Transformer) ---
Extracted 1 claims.
 - Breaking News: Aliens have landed in New York City... (Conf: 0.8)

Testing keyframe extraction and face cropping...
Node V1: Extracting keyframes and tracking faces...
[DEBUG] V1: Video FPS: 30.0, Size: 640x480
[DEBUG] V1: CUDA backend failed (OpenCV(4.11.0) D:\a\opencv-python\opencv-python\opencv\modules\dnn\src\net_impl.cpp:120: error: (-215:Assertion failed) preferableBackend != DNN_BACKEND_CUDA || IS_DNN_CUDA_TARGET(preferableTarget) in function 'cv::dnn::dnn4_v20241223::Net::Impl::validateBackendAndTarget'
), falling back to CPU.
Extracted 2 keyframes.
[DEBUG] V1: Saved keyframes to test_v1_keyframes\keyframes
[DEBUG] V1: Saved face crops to test_v1_keyframes\faces
[DEBUG] V1: Detected 0 valid faces
Keyframe extraction and face cropping test passed.

Testing missing video file...
Node V1: Extracting keyframes and tracking faces...
Error: Data directory not found at non_existent_dir
Missing video test passed.

Testing no keyframes...
Node V2: Extracting text from keyframes (OCR)...
Keyframes: []
Warning: No keyframes found in state. Skipping OCR.
No keyframes test passed.

Testing OCR extraction...
Node V2: Extracting text from keyframes (OCR)...
Keyframes: ['test_v2_ocr\\test_text.jpg']
[DEBUG] V2: CUDA not available, using CPU for EasyOCR.
[DEBUG] V2: Processing test_text.jpg...
OCR complete. Found text in 1 frames.
Detected text: HELLO WORLD
OCR extraction test passed.

Testing landmark extraction with Face Alignment...
Node V3: Extracting mouth landmarks (Time-series) with Robust Tracking...
[DEBUG] V3: Using device: cuda
Extracted mouth landmarks for 1 frames.
Visualization saved to test_v3_landmarks\landmarks_viz.mp4
Landmark extraction test passed.

Testing missing video...
Node V3: Extracting mouth landmarks (Time-series) with Robust Tracking...
Error: Data directory not found at non_existent_dir
Missing video test passed.

Testing V4 blink and pose extraction...
Node V4: Analyzing Blink (FaceAlignment) and Head Pose (SixDRepNet)...
[DEBUG] V4: Using device: cpu
V4 Analysis complete. Extracted 2 blink samples and 2 pose samples.
V4 extraction test passed.

Testing missing video for V4...
Node V4: Analyzing Blink (FaceAlignment) and Head Pose (SixDRepNet)...
Error: Data directory not found at non_existent_dir
V4 missing video test passed.

Ran 44 tests.
Passed: 41
Failed: 3
Errors: 0
